server.port=7001
spring.application.name=funaistudioworkspace

# Swagger UI ??
# Spring Boot 3 + springdoc 2.x ????? /swagger-ui/index.html
springdoc.swagger-ui.path=/swagger-ui
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.operationsSorter=method
# ?? Swagger UI
springdoc.swagger-ui.enabled=true
# ??????????
spring.web.resources.add-mappings=true
# ?? springdoc ????
springdoc.api-docs.enabled=true

# -----------------------------
# Workspace（用户在线开发容器）配置（生产环境）
# -----------------------------
funai.workspace.enabled=true
funai.workspace.hostRoot=/data/funai/workspaces
# 使用你已经 push 到个人版 ACR 的 node 镜像（示例）
# funai.workspace.image=crpi-39dn3ekytub82xl9.cn-hangzhou.personal.cr.aliyuncs.com/funshion/funai-node:24.12.0-bookworm-slim
funai.workspace.image=crpi-39dn3ekytub82xl9.cn-hangzhou.personal.cr.aliyuncs.com/funshion/funai-node-mongo:node24.12.0-mongo7.0.14-mongosh-bookworm-slim
funai.workspace.containerPort=5173
## 预览 URL base（不含端口），后端会拼接 :{hostPort}/
funai.workspace.previewBaseUrl=http://47.118.27.59
## nginx auth_request 内部端口查询接口的共享密钥（nginx 需要在子请求中带 Header：X-WS-Token）
funai.workspace.nginxAuthToken=5082883253738cc32576088cc023b6dfe13aabe155fdd4b16196f387da3bbdb2
funai.workspace.hostPortBase=20000
funai.workspace.hostPortScanSize=2000
funai.workspace.containerWorkdir=/workspace
funai.workspace.containerNamePrefix=ws-u-
# podman/docker 网络名：让 workspace 容器通过容器网络访问 Verdaccio（不依赖访问宿主机）
funai.workspace.networkName=funai-net
# npm registry（推荐同机 Verdaccio；容器内用）：http://verdaccio:4873
funai.workspace.npmRegistry=http://verdaccio:4873

# npm cache：避免 ~/.npm 造成用户容器层膨胀（删项目不回收磁盘）
# - APP：缓存落到 apps/{appId}/.npm-cache，删除项目目录即可回收（推荐）
funai.workspace.npmCacheMode=APP
# 超过阈值会清理 cache 的大头目录（_cacache/_npx）
funai.workspace.npmCacheMaxMb=1024
funai.workspace.httpProxy=http://host.containers.internal:3128
funai.workspace.httpsProxy=http://host.containers.internal:3128
funai.workspace.noProxy=localhost,127.0.0.1,verdaccio,host.containers.internal
# 保守回收策略：减少容器常驻的资源占用
funai.workspace.idleStopRunMinutes=15
funai.workspace.idleStopContainerMinutes=30
# run STARTING 超时（避免前端无限转圈）
funai.workspace.runStartingTimeoutSeconds=300
# 受控任务日志保留（避免 run 目录无限增长）
funai.workspace.runLogKeepPerType=30

# 容器资源限制（保守）：防止少数用户把宿主机打满
# 8c32g 推荐先保守跑稳，再按真实并发/体验逐步放宽
funai.workspace.dockerMemory=2048m
funai.workspace.dockerMemorySwap=2048m
funai.workspace.dockerCpus=1.0
funai.workspace.pidsLimit=512

# -----------------------------
# Workspace Mongo（可选）：在用户 workspace 容器内启动本地 mongod，并使用宿主机 bind mount 持久化
# 说明：
# - 一个用户容器仅一个 mongod（dbPath 用户级固定）
# - 每个项目按 dbName 隔离：dbName = {dbNamePrefix}{appId}
# -----------------------------
funai.workspace.mongo.enabled=true
funai.workspace.mongo.hostRoot=/data/funai/database
funai.workspace.mongo.containerDbPath=/data/db
funai.workspace.mongo.containerLogDir=/var/log/mongodb
funai.workspace.mongo.bindIp=127.0.0.1
funai.workspace.mongo.port=27017
funai.workspace.mongo.dbNamePrefix=db_
funai.workspace.mongo.logFileName=mongod.log
# 2GiB 机器强烈建议设置，避免 mongod 默认 cache 吃掉大半内存
funai.workspace.mongo.wiredTigerCacheSizeGB=0.25

# ????
logging.level.root=INFO

# -----------------------------
# 日志落盘（workspace-dev / workspace-node）
# -----------------------------
logging.file.name=/data/funai/logs/fun-ai-studio-workspace/app.log

# 按天滚动 + 按大小分片（必须包含 %i；gzip 压缩）
logging.logback.rollingpolicy.file-name-pattern=/data/funai/logs/fun-ai-studio-workspace/app.%d{yyyy-MM-dd}.%i.log.gz
# 单文件最大大小（超过会在同一天内滚动到下一个 %i）
logging.logback.rollingpolicy.max-file-size=100MB

# 保留最近 30 天
logging.logback.rollingpolicy.max-history=30

# 总日志大小上限（超过会清理旧日志）
logging.logback.rollingpolicy.total-size-cap=10GB

# 启动时清理超期日志
logging.logback.rollingpolicy.clean-history-on-start=true


# -----------------------------
# workspace-node 内部鉴权（只信任 API 服务器（小机））
# - 先跑通：requireSignature=false（仅靠安全组+IP allowlist）
# - API 服务器（小机）代理层加签后：再改为 true
# -----------------------------
workspace-node.internal.allowed-source-ip=47.118.27.59
workspace-node.internal.shared-secret=ac462cfa76135504d2b750d541064ed5f03eb9f78f9068645995c4f825455f52
workspace-node.internal.require-signature=true
